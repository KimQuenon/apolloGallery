{% extends "base.html.twig" %}

{% block title %}
    My sales
{% endblock %}

{% block body %}
{% include "partials/_display.html.twig" with {'context': context, 'artwork': artwork}  %}
<div class="container">
    <h1>Sales of {{ artwork.title }}</h1>
    <img class="img-fluid" src="{{ artwork.coverImage }}" alt="{{ artwork.title }}">
    <div class="row">
        {% if not auctionAccepted %}
            {% if topThree|length > 0 %}
                <h2>Top Three Bids</h2>
                <div>
                    {% for bid in topThree %}
                        <p>{{ bid.user.fullName }}: {{ bid.amount }}</p>
                        <span class='rating'>
                            {% set filledStars = bid.user.avgRatings | round(0, 'floor') %}
                            {% set halfStar = (bid.user.avgRatings - filledStars) >= 0.5 %}
                            
                            {% for i in 1..5 %}
                                {% if i <= filledStars %}
                                    <i class='fas fa-star'></i>
                                {% elseif halfStar %}
                                    {% if loop.index == filledStars + 1 %}
                                        <i class='fas fa-star-half-alt'></i>
                                    {% else %}
                                        <i class='far fa-star'></i>
                                    {% endif %}
                                {% else %}
                                    <i class='far fa-star'></i>
                                {% endif %}
                            {% endfor %}
                        </span>
                        <p>{{ bid.user.reviews | length}} avis</p>
                    {% endfor %}
                </div>
            {% endif %}
            {% if auctions|length > 0 %}
                {% for auction in auctions %}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title">{{ auction.user.fullName }}</h5>
                                    <span class='rating'>
                                        {% set filledStars = auction.user.avgRatings | round(0, 'floor') %}
                                        {% set halfStar = (auction.user.avgRatings - filledStars) >= 0.5 %}
                                        
                                        {% for i in 1..5 %}
                                            {% if i <= filledStars %}
                                                <i class='fas fa-star'></i>
                                            {% elseif halfStar %}
                                                {% if loop.index == filledStars + 1 %}
                                                    <i class='fas fa-star-half-alt'></i>
                                                {% else %}
                                                    <i class='far fa-star'></i>
                                                {% endif %}
                                            {% else %}
                                                <i class='far fa-star'></i>
                                            {% endif %}
                                        {% endfor %}
                                    </span>
                                    ({{ auction.user.reviews | length}} avis)
                                    {# {% include "partials/rating.html.twig" with {'rating': auction.user.avgRatings} %} #}
                                    <div>
                                    </div>
                                    <p class="card-text">{{ auction.amount }}</p>
                                    {% if artwork.endDate < currentDate  %}
                                        <a href="{{ path('account_sales_accept', {'id': auction.id}) }}" class="btn btn-success">Accepter</a>
                                        <a href="{{ path('account_sales_refuse', {'id': auction.id}) }}" class="btn btn-danger">Refuser</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div>
                    <p>Aucune enchère n'a été faite pour cette oeuvre.</p>
                    <a href="{{ path('account_sales_relaunch', {'slug': artwork.slug}) }}" class="btn btn-warning">Relancer</a>
                    <a href="{{ path('artworks_delete', {'slug': artwork.slug}) }}" class="btn btn-danger">Supprimer</a>
                </div>
            {% endif %}
        {% else %}
            <div>
                <p>Une offre a déjà été acceptée.</p>
            </div>
        {% endif %} 
    </div>
</div>


{% endblock %}
